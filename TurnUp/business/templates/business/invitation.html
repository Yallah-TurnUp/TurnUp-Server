<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie ie9" lang="en"><![endif]-->
<!--[if gt IE 9 | !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>

    <link rel='shortcut icon' href='../../static/img/favicon.ico' type='image/x-icon'/>
    <link rel='icon' href='../../static/img/favicon.ico' type='image/x-icon'/>
    <link rel='stylesheet' href='../../static/css/blue.css'/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=10,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel='stylesheet' href='../../static/css/bootstrap.min.css'>
    <title>TurnUp</title>

</head>
<body>
<div class="section-full align-c">
    <div id="siteBg" class="site-bg">
        <!--<div id="star_animation" class="site-bg-animation layer" data-depth="0.30"></div>-->
        <canvas class="site-bg-canvas layer" data-depth="0.30"></canvas>
        <img id="invitation" src="../../static/img/bg/invite.png"/>
        <div id="register" style="width: 100vw; display: none; text-align: center; position: absolute; bottom: 15vh;">
            <button id="thumbs_down" type="button" style="background: #ca3026;" class="button_splash" data-toggle="modal" data-target="#Fail" onclick="submitNo();">SORRY, I CANNOT COME</button>
            <button id="thumbs_up" type="button" class="button_splash shakee" data-toggle="modal" data-target="#ContactUs">I WOULD LOVE TO COME</button>
        </div>
        <img id="school-logo" src="../../static/img/bg/Logo.png"/>
        <div class="modal fade" id="ContactUs" role="dialog" tabindex="-1">
            <div class="modal-dialog" role="document" style="overflow-y: initial !important">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h1 style="color: #59697b;">WELCOME</h1>
                    </div>
                    <div class="modal-body" style="overflow-y: auto; text-align:center; height: 50vh;">
                        <div id="common_form" class="my_container" style="overflow: hidden;">
                            <div class="my_container">
                                <h4 id="header_time">Please click on the event you want to attend:</h4>
                                <div class="btn-group-vertical" data-toggle="buttons">
                                    <label class="btn btn-warning active" style="display: inline-block; border-radius: 4px; margin-top: 8px;">
                                        <input type="radio" name="preference" checked value="1">
                                        <span style="float: left;">PITCH</span>
                                        <span style="float: right;">10:45AM - 12:00PM</span>
                                    </label>
                                    <label class="btn btn-warning" style="display: inline-block; border-radius: 4px; margin-top: 8px;">
                                        <input type="radio" name="preference"  value="2">
                                        <span style="float: left;">APPRECIATION LUNCH</span>
                                        <span style="float: right;">12:00AM - 02:00PM</span>
                                    </label>
                                    <label class="btn btn-warning" style="display: inline-block; border-radius: 4px; margin-top: 8px;">
                                        <input type="radio" name="preference"  value="3">
                                        <span style="float: left;">BOTH</span><span style="float: right;">10:45AM - 02:00PM</span>
                                    </label>
                                </div>
                            </div>

                            <div class="my_container">
                                <h4 id="header_dietary">Kosher lunch will be served buffet style. Let us know if you have any dietary restrictions:</h4>
                                <input id="dietary" type="text" placeholder="ie. Peanuts"/>
                            </div>
                            <div class="my_container" style="padding-bottom: 0;">
                                <h4 id="header_map">Click below to get directions:</h4>
                                <a href="https://goo.gl/maps/E1CfCy8ydxv" target="_blank">
                                    <img style="width: 90%; height: auto; cursor: pointer;-webkit-box-shadow: 0px 10px 50px 0px rgba(84,84,84,0.7);-moz-box-shadow: 0px 10px 50px 0px rgba(84,84,84,0.7);box-shadow: 0px 10px 50px 0px rgba(84,84,84,0.7);" src="../../static/img/item/Capture.PNG"/>
                                </a>
                            </div>
                        </div>
                        <div id="load-spin" class="container" style="align-content: center;">
                            <div class="contact_message" style="color: #59697b;">Please wait while we process your information...</div>
                            <div class="loading-spinner"  style="width: 90%; margin-left: auto; margin-right: auto;">
                                <div class="progress progress-striped active">
                                    <div class="progress-bar" style="width: 100%;"></div>
                                </div>
                            </div>
                        </div>

                        <div id='thank_you'>
                            <img class="form_complete_img" src="../../static/img/item/green_tick.png"/>
                            <div class="contact_message" style="color: #59697b;">We've gotten your message and will contact you shortly, thank you!</div>
                            <a href="http://dariuspjm.wixsite.com/turnup">Like the invitation? Check us out!</a>
                        </div>
                    </div>
                    <div class="modal-footer" style="height: 10vh;">
                        <button id="footer_button" type="submit" onclick="submitSuccess();" class="button_splash">CONFIRM</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="Fail" role="dialog" tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h1 style="color: #59697b;">THANK YOU</h1>
                    </div>

                    <div class="modal-body" style="text-align:center;">
                        <div id='rdd'>
                            <img class="form_complete_img" src="../../static/img/item/green_tick.png"/>
                            <div class="contact_message" style="color: #59697b;">We've gotten your message!</div>
                        </div>
                    </div>
                    <div class="modal-footer" style="height: 10vh;">
                        <a style="font-size: medium;" href="http://dariuspjm.wixsite.com/turnup">Like the invitation? Check us out!</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="../../static/js/jquery-1.9.1.js"></script>
<script src="../../static/js/bootstrap.min.js"></script>
<script src='../../static/js/vendor/plugin.js'></script>
<script src='../../static/js/variable.js'></script>
<script src='../../static/js/main.js'></script>

<script>
//    $( window ).load(function() {
//        $('#main_content').show();
//        setTimeout(function (){$(document).trigger('is-loaded');
//        }, 1000);
//    });

    $(document).ready(function () {
        setTimeout(function (){$('#register').fadeIn();
        }, 1500);
    });

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    function sendRSVPInfo(attending, commonAvailabilityArray) {
        var rsvpData = {
            attending: attending,
            commonAvailability: commonAvailabilityArray,
            id: getUrlParameter('id'),
        };
        $.ajax({
            type: 'POST',
            url: '/rsvp',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(rsvpData),
        });
    }

    function submitNo () {
        sendRSVPInfo(false);
        setTimeout(function (){$('#Fail').hide();}, 4000);
    }

    function submitSuccess () {
        var dietary = document.getElementById('dietary').value;
        sendRSVPInfo(true, {
            dietary: dietary,
            program: getCheckboxData('preference'),
            parking: getCheckboxData('car'),
        });
        $('#common_form').hide();
        $('#footer_button').hide();
        $('#load-spin').show();
        setTimeout(function (){$('#load-spin').hide();}, 2000);
        setTimeout(function (){$('#thank_you').show();}, 2000);
    }

    function getCheckboxData (checkboxName) {
        var checkboxes = document.querySelectorAll('input[name="' + checkboxName + '"]:checked'), values = [];
        checkboxes.forEach(function(el) {
            values.push(el.value);
        });
        return values;
    }
</script>
</body>
</html>